<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒªè½¦å°åŠ©æ‰‹</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }
        .container {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size:42px;
        }
        .notification-count {
            text-align: center;
            margin-bottom: 20px;
            font-size: 18px;
            color: #007bff;
        }
        .message-area {
            margin-bottom: 20px;
        }
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: none;
            font-size: 16px;
            margin-bottom: 5px;
        }
        .char-count {
            text-align: right;
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .templates {
            margin-bottom: 20px;
        }
        .template-btn {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 8px 15px;
            margin: 0 5px 5px 0;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        .template-btn:hover { background: #e9ecef; }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .btn {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .notify-btn {
            background: linear-gradient(45deg, #00b09b, #96c93d);
	    color: white;
        }
        .notify-btn:hover { 
	    box-shadow: 0 6px 20px rgba(0, 176, 155, 0.3);
            transform: translateY(-2px); }
        .call-btn {  
	    background: linear-gradient(45deg, #5370e6, #8558e9);
            color: white;
	    display: none; } /* é»˜è®¤éšè—æ‹¨æ‰“ç”µè¯æŒ‰é’® */
        .call-btn:hover {
	     box-shadow: 0 6px 20px rgba(71, 118, 230, 0.3);
            transform: translateY(-2px);}
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { position: relative; background-color: white; margin: 20% auto; padding: 20px; width: 90%; max-width: 400px; border-radius: 10px; text-align: center; }
        .modal-title { margin-bottom: 15px; font-size: 18px; color: #2c3e50; }
        .modal-phone { font-size: 24px; color: #007bff; margin-bottom: 20px; }
        .modal-buttons { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 8px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: all 0.3s ease; }
        .confirm-btn { background: #28a745; color: white; }
        .confirm-btn:hover { background: #218838; }
        .cancel-btn { background: #dc3545; color: white; }
        .cancel-btn:hover { background: #c82333; }
    </style>
</head>
<body>
<div class="container">
    <h1>æ‰«ç æŒªè½¦å°ç¨‹åº</h1>
	<h3 align="center">éå¸¸æŠ±æ­‰ï¼Œé˜»ç¢åˆ°æ‚¨çš„å‡ºè¡Œäº†ï¼<h3>
	<h3 align="center">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€šçŸ¥è½¦ä¸»æŒªè½¦ï¼<h3>
    <div class="notification-count" id="notificationCountDisplay">å·²å‘é€é€šçŸ¥æ¬¡æ•°ï¼š0/3</div> <!-- æ˜¾ç¤ºå‘é€æ¬¡æ•° -->
    <div class="message-area">
        <textarea id="messageInput" placeholder="è¯·è¾“å…¥é€šçŸ¥å†…å®¹" oninput="updateCharCount()"></textarea>
        <div id="charCount" class="char-count">0/200å­—</div>
    </div>
    <div class="templates">
        <button class="template-btn" onclick="useTemplate('æ‚¨å¥½ï¼Œæœ‰äººéœ€è¦æ‚¨æŒªè½¦ï¼Œè¯·åŠæ—¶å¤„ç†ã€‚')">é»˜è®¤</button>
        <button class="template-btn" onclick="useTemplate('æ‚¨å¥½ï¼Œæ‚¨çš„è½¦è¾†é˜»ç¢ä»–äººé€šè¡Œï¼Œè¯·å°½å¿«æŒªè½¦ï¼Œè°¢è°¢é…åˆã€‚')">ç¤¼è²Œæ¨¡æ¿</button>
        <button class="template-btn" onclick="useTemplate('ç´§æ€¥æƒ…å†µï¼æ‚¨çš„è½¦è¾†é˜»ç¢æ¶ˆé˜²é€šé“ï¼Œè¯·ç«‹å³æŒªè½¦ï¼')">ç´§æ€¥æ¨¡æ¿</button>
        <button class="template-btn" onclick="useTemplate('æ‚¨çš„è½¦è¾†åœæ”¾æ—¶æœªå®Œå…¨å…³é—­è½¦çª—ã€‚ä¸ºé¿å…é›¨æ°´è¿›å…¥è½¦å†…æˆ–ä¸¢å¤±ç‰©å“ï¼Œè¯·å°½å¿«æ£€æŸ¥å¹¶å…³é—­è½¦çª—ï¼')">å…³çª—æé†’</button>
    </div>
    <div class="action-buttons">
        <button id="notifyBtn" class="btn notify-btn" onclick="notifyOwner()">å¾®ä¿¡ä¸€é”®é€šçŸ¥è½¦ä¸»ğŸ“±</button>
        <button id="callBtn" class="btn call-btn" onclick="showCallModal()">ä¸€é”®æ‹¨æ‰“è½¦ä¸»ç”µè¯ğŸ“</button> <!-- é»˜è®¤éšè—æ‹¨æ‰“ç”µè¯æŒ‰é’® -->
    </div>
</div>
<!-- æ¨¡æ€æ¡† -->
<div id="callModal" class="modal">
    <div class="modal-content">
        <div class="modal-title">è½¦ä¸»ç”µè¯å·ç </div>
        <div id="phoneNumber" class="modal-phone"></div> <!-- ç”µè¯å·ç å°†åŠ¨æ€è®¾ç½® -->
        <div class="modal-buttons">
            <button class="modal-btn confirm-btn" onclick="callOwner()">å‘¼å«</button>
            <button class="modal-btn cancel-btn" onclick="closeModal()">å–æ¶ˆ</button>
        </div>
    </div>
</div>
<script>
  // é…ç½®è½¦ä¸»ä¿¡æ¯å’Œ Wxpusher API
  const phone = '13006855113';  // è½¦ä¸»çš„æ‰‹æœºå·
  const wxpusherAppToken = 'AT_FggIqEWlvf7Nuw0SM8G9M1A1zzq2yn2o'; // Wxpusher APP Token
  const wxpusherUIDs = ['UID_75WmwMc8oXLD2vVtApVKK85g38YX']; // è½¦ä¸»çš„UIDæ•°ç»„
  const forbiddenWords = [
	"æ“ä½ ",
	"ä½ å¦ˆ",
	"ä½ ä»–å¦ˆ",
	"å¦ˆçš„",
    "å»æ­»",
    "æ­»",
    "å‚»é€¼",
    "ç•œç”Ÿ",
    "çŒª",
    "ç‹—",
    "åƒåœ¾",
    "æœ‰ç—…",
    "ç¥ç»ç—…",
    "ä¹¡é‡Œåˆ«",
    "æ¶å¿ƒ",
    "é—­å˜´",
    "åˆ«åºŸè¯",
    "å¹¿å‘Š",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "æ¨å¹¿",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "ä¼˜æƒ ",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "å…è´¹",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "ç‚¹å‡»",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "æ³¨å†Œ",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "èµšé’±",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "ä»£ç†",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "è½¬å‘",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "ä¿¡æ¯",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "æ´»åŠ¨",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "è´­ä¹°",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "æœåŠ¡",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "å®£ä¼ ",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "è¥é”€",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "ç½‘ç«™",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "é“¾æ¥",       // å¹¿å‘Šç›¸å…³è¯æ±‡
    "æŠ˜æ‰£",       // ä¸æŠ˜æ‰£ç›¸å…³çš„è¯æ±‡
    "ç‰¹ä»·",       // ä¸æŠ˜æ‰£ç›¸å…³çš„è¯æ±‡
    "ä¼˜æƒ åˆ¸",     // ä¸æŠ˜æ‰£ç›¸å…³çš„è¯æ±‡
    "ä¿ƒé”€",       // ä¸æŠ˜æ‰£ç›¸å…³çš„è¯æ±‡
    "æ‰“æŠ˜",       // ä¸æŠ˜æ‰£ç›¸å…³çš„è¯æ±‡
    "ä¿å•",       // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "ç†èµ”",       // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "æŠ•ä¿",       // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "ä¿é™©å…¬å¸",   // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "è½¦é™©",       // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "æ„å¤–é™©",     // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
    "åŒ»ç–—é™©"      // ä¸ä¿é™©ç›¸å…³çš„è¯æ±‡
	]; // è¿ç¦è¯åˆ—è¡¨
    let notificationCount = 0; // é€šçŸ¥å‘é€æ¬¡æ•°
    let lastNotificationTime = 0; // ä¸Šæ¬¡é€šçŸ¥æ—¶é—´
    const cooldownTime = 30000; // 30ç§’å†·å´æ—¶é—´

    // æ›´æ–°å­—ç¬¦æ•°
    function updateCharCount() {
        const message = document.getElementById("messageInput").value;
        const count = message.length;
        document.getElementById("charCount").textContent = `${count}/200å­—`;
    };

    // ä½¿ç”¨å¿«æ·æ¨¡æ¿
    function useTemplate(template) {
        document.getElementById("messageInput").value = template;
        updateCharCount();
    };

    // æ£€æŸ¥è¿ç¦è¯
    function containsForbiddenWords(message) {
        return forbiddenWords.some(word => message.includes(word));
    };

    // å‘é€é€šçŸ¥
    function notifyOwner() {
        const message = document.getElementById("messageInput").value;
        // è¿ç¦è¯æ£€æŸ¥
        if (containsForbiddenWords(message)) {
            alert("é€šçŸ¥å†…å®¹åŒ…å«è¿ç¦è¯ï¼Œæ— æ³•å‘é€");
            return;
        }
        // é€šçŸ¥å‘é€é¢‘ç‡é™åˆ¶
        const currentTime = new Date().getTime();
        if (currentTime - lastNotificationTime < cooldownTime) {
            const remainingTime = Math.ceil((cooldownTime - (currentTime - lastNotificationTime)) / 1000);
            alert(`è¯·ç­‰å¾… ${remainingTime} ç§’åå†å‘é€é€šçŸ¥ã€‚`);
            return;
        }
        
	lastNotificationTime = currentTime;
        notificationCount++;

        // æ›´æ–°å‘é€æ¬¡æ•°æ˜¾ç¤º
        document.getElementById("notificationCountDisplay").textContent = `å·²å‘é€é€šçŸ¥æ¬¡æ•°ï¼š${notificationCount}/3`;

        // å‘é€é€šçŸ¥é€»è¾‘
        fetch("https://wxpusher.zjiecode.com/api/send/message", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                appToken: wxpusherAppToken,
                content: message,
                contentType: 1,
                uids: wxpusherUIDs
            })
        })
 .then(response => response.json())
    .then(data => {
      if (data.code === 1000) {
        alert("é€šçŸ¥å·²é€è¾¾ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚");
	document.getElementById("messageInput").value = '';
        updateCharCount();
      } else {
        alert("é€šçŸ¥å‘é€å¤±è´¥ï¼Œè¯·è¾“å…¥é€šçŸ¥å†…å®¹ã€‚");
	document.getElementById("messageInput").value = '';
        updateCharCount();
      }
    })
    .catch(error => {
      console.error("Error sending notification:", error);
      alert("é€šçŸ¥å‘é€å‡ºé”™ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥ã€‚");
      document.getElementById("messageInput").value = '';
      updateCharCount();
    });
        // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°æ˜¾ç¤ºç”µè¯å·ç çš„æ¡ä»¶
        if (notificationCount >= 3) {
	    document.getElementById("notifyBtn").style.display = "none"; // è¾¾åˆ°æŒ‡å®šæ¬¡æ•°åéšè—å‘é€ä¿¡æ¯æŒ‰é’®
            document.getElementById("callBtn").style.display = "block"; // å‘é€é€šçŸ¥åæ˜¾ç¤ºæ‹¨æ‰“ç”µè¯æŒ‰é’®
        }
    };

    // æ˜¾ç¤ºç”µè¯æ¨¡æ€æ¡†
    function showCallModal() {
        document.getElementById("callModal").style.display = "block";
        document.getElementById("phoneNumber").textContent = 'å·ç æ˜¾ç¤ºå·²åŠ å¯†'; // åœ¨æ¨¡æ€æ¡†ä¸­æ˜¾ç¤ºç”µè¯å·ç 
    };

    // æ‹¨æ‰“ç”µè¯
    function callOwner() {
        window.location.href = `tel:${phone}`;
    };

    // å…³é—­æ¨¡æ€æ¡†
    function closeModal() {
        document.getElementById("callModal").style.display = "none";
    };
	
// å¯¹æµè§ˆå™¨çš„UserAgentè¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œä¸å«æœ‰å¾®ä¿¡ç‹¬æœ‰æ ‡è¯†çš„åˆ™ä¸ºå…¶ä»–æµè§ˆå™¨
    var useragent = navigator.userAgent;
    if (useragent.match(/MicroMessenger/i) != 'MicroMessenger') {
        // è¿™é‡Œè­¦å‘Šæ¡†ä¼šé˜»å¡å½“å‰é¡µé¢ç»§ç»­åŠ è½½
        alert('å·²ç¦æ­¢æœ¬æ¬¡è®¿é—®ï¼šæ‚¨å¿…é¡»ä½¿ç”¨å¾®ä¿¡æ‰«æäºŒç»´ç è®¿é—®æœ¬é¡µé¢ï¼');
        // ä»¥ä¸‹ä»£ç æ˜¯ç”¨javascriptå¼ºè¡Œå…³é—­å½“å‰é¡µé¢
        var opened = window.open('about:blank', '_self');
        opened.opener = null;
        opened.close();
    };

//éšè—å¼¹çª—ç½‘å€
(function(){
window.alert = function(name){
var iframe = document.createElement("IFRAME");
iframe.style.display="none";
iframe.setAttribute("src", 'data:text/plain');
document.documentElement.appendChild(iframe);
window.frames[0].window.alert(name);
iframe.parentNode.removeChild(iframe);
}
})();
</script>
</body>
</html>
